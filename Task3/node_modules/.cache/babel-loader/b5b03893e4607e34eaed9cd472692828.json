{"ast":null,"code":"import _classCallCheck from \"/Users/soham/Desktop/JPMC/JPMC-tech-task-3-PY3/node_modules/@babel/runtime/helpers/esm/classCallCheck\";\nimport _createClass from \"/Users/soham/Desktop/JPMC/JPMC-tech-task-3-PY3/node_modules/@babel/runtime/helpers/esm/createClass\";\nimport _possibleConstructorReturn from \"/Users/soham/Desktop/JPMC/JPMC-tech-task-3-PY3/node_modules/@babel/runtime/helpers/esm/possibleConstructorReturn\";\nimport _getPrototypeOf from \"/Users/soham/Desktop/JPMC/JPMC-tech-task-3-PY3/node_modules/@babel/runtime/helpers/esm/getPrototypeOf\";\nimport _inherits from \"/Users/soham/Desktop/JPMC/JPMC-tech-task-3-PY3/node_modules/@babel/runtime/helpers/esm/inherits\";\nimport React, { Component } from 'react';\nimport { DataManipulator } from './DataManipulator';\nimport './Graph.css';\n\nvar Graph =\n/*#__PURE__*/\nfunction (_Component) {\n  _inherits(Graph, _Component);\n\n  function Graph() {\n    var _getPrototypeOf2;\n\n    var _this;\n\n    _classCallCheck(this, Graph);\n\n    for (var _len = arguments.length, args = new Array(_len), _key = 0; _key < _len; _key++) {\n      args[_key] = arguments[_key];\n    }\n\n    _this = _possibleConstructorReturn(this, (_getPrototypeOf2 = _getPrototypeOf(Graph)).call.apply(_getPrototypeOf2, [this].concat(args)));\n    _this.table = void 0;\n    return _this;\n  }\n\n  _createClass(Graph, [{\n    key: \"render\",\n    value: function render() {\n      return React.createElement('perspective-viewer');\n    }\n  }, {\n    key: \"componentDidMount\",\n    value: function componentDidMount() {\n      // Get element from the DOM.\n      var elem = document.getElementsByTagName('perspective-viewer')[0];\n      var schema = {\n        price_abc: 'float',\n        price_def: 'float',\n        ratio: 'float',\n        lower_bound: 'float',\n        upper_bound: 'float',\n        trigger_alert: 'float',\n        timestamp: 'date'\n      };\n      /*\n      ● Since we don’t want to distinguish between two stocks now, but instead want to track their\n        ratios, we made sure to add the ratio field. Since we also wanted to track upper_bound,\n        lower_bound, and the moment when these bounds are crossed i.e. trigger_alert, we had to\n        add those fields too.\n      ● Finally, the reason we added price_abc and price_def is just because these were necessary\n         get the ratio as you will see later. We won’t be configuring the graph to show them anyway.\n      ● Of course since we’re tracking all of this with respect to time, timestamp is going to be there\n      */\n\n      if (window.perspective && window.perspective.worker()) {\n        this.table = window.perspective.worker().table(schema);\n      }\n\n      if (this.table) {\n        // Load the `table` in the `<perspective-viewer>` DOM reference.\n        elem.load(this.table);\n        elem.setAttribute('view', 'y_line'); // elem.setAttribute('column-pivots', '[\"stock\"]');\n\n        elem.setAttribute('row-pivots', '[\"timestamp\"]');\n        elem.setAttribute('columns', '[\"top_ask_price\"]');\n        elem.setAttribute('aggregates', JSON.stringify({\n          price_abc: 'avg',\n          price_def: 'avg',\n          ratio: 'avg',\n          lower_bound: 'avg',\n          upper_bound: 'avg',\n          trigger_alert: 'avg',\n          timestamp: 'distinct count'\n        }));\n      }\n    }\n    /* \n    ● ‘view’ is the the kind of graph we wanted to visualize the data as. Initially, this is\n      already set to y_line. This is the type of graph we want so we’re good here.\n    ● ‘column-pivots’ used to exist and was what allowed us to distinguish / split\n      stock ABC with DEF back in task 2. We removed this because we’re concerned\n      about the ratios between two stocks and not their separate prices\n    ● ‘row-pivots’ takes care of our x-axis. This allows us to map each datapoint\n      based on the timestamp it has. Without this, the x-axis is blank. So this field\n      and its value remains\n    ● ‘columns’ is what will allow us to only focus on a particular part of a datapoint’s\n      data along the y-axis. Without this, the graph will plot all the fields and values of\n      each datapoint and it will be a lot of noise. For this case, we want to track ratio,\n      lower_bound, upper_bound and trigger_alert.\n    ● ‘aggregates’ is what will allow us to handle the cases of duplicated data we\n      observed way back in task 2 and consolidate them as just one data point. In\n      our case we only want to consider a data point unique if it has a timestamp.\n      Otherwise, we will average out the all the values of the other non-unique fields\n      these ‘similar’ datapoints before treating them as one (e.g. ratio, price_abc, …)\n    */\n\n  }, {\n    key: \"componentDidUpdate\",\n    value: function componentDidUpdate() {\n      if (this.table) {\n        this.table.update([DataManipulator.generateRow(this.props.data)]);\n      }\n    }\n  }]);\n\n  return Graph;\n}(Component);\n/* \n● To fully achieve our goal in this task, we have to make some modifications in\n  the DataManipulator.ts file. This file will be responsible for processing the raw\n  stock data we’ve received from the server before it throws it back to the Graph\n  component’s table to render. Initially, it’s not really doing any processing hence\n  we were able to keep the status quo from the finished product in task 2\n● The first thing we have to modify in this file is the Row interface. If you notice,\n  the initial setting of the Row interface is almost the same as the old schema in\n  Graph.tsx before we updated it. So now, we have to update it to match the\n  new schema. See next slide to better visualize the change that’s supposed to\n  happen. \n*/\n\n\nexport default Graph;","map":{"version":3,"sources":["/Users/soham/Desktop/JPMC/JPMC-tech-task-3-PY3/src/Graph.tsx"],"names":["React","Component","DataManipulator","Graph","table","createElement","elem","document","getElementsByTagName","schema","price_abc","price_def","ratio","lower_bound","upper_bound","trigger_alert","timestamp","window","perspective","worker","load","setAttribute","JSON","stringify","update","generateRow","props","data"],"mappings":";;;;;AAAA,OAAOA,KAAP,IAAgBC,SAAhB,QAAiC,OAAjC;AAGA,SAASC,eAAT,QAAgC,mBAAhC;AACA,OAAO,aAAP;;IASMC,K;;;;;;;;;;;;;;;;;UACJC,K;;;;;;6BAES;AACP,aAAOJ,KAAK,CAACK,aAAN,CAAoB,oBAApB,CAAP;AACD;;;wCAEmB;AAClB;AACA,UAAMC,IAAI,GAAGC,QAAQ,CAACC,oBAAT,CAA8B,oBAA9B,EAAoD,CAApD,CAAb;AAEA,UAAMC,MAAM,GAAG;AACbC,QAAAA,SAAS,EAAE,OADE;AAEbC,QAAAA,SAAS,EAAE,OAFE;AAGbC,QAAAA,KAAK,EAAE,OAHM;AAIbC,QAAAA,WAAW,EAAE,OAJA;AAKbC,QAAAA,WAAW,EAAE,OALA;AAMbC,QAAAA,aAAa,EAAE,OANF;AAObC,QAAAA,SAAS,EAAE;AAPE,OAAf;AAUA;;;;;;;;;;AAUA,UAAIC,MAAM,CAACC,WAAP,IAAsBD,MAAM,CAACC,WAAP,CAAmBC,MAAnB,EAA1B,EAAuD;AACrD,aAAKf,KAAL,GAAaa,MAAM,CAACC,WAAP,CAAmBC,MAAnB,GAA4Bf,KAA5B,CAAkCK,MAAlC,CAAb;AACD;;AACD,UAAI,KAAKL,KAAT,EAAgB;AACd;AACAE,QAAAA,IAAI,CAACc,IAAL,CAAU,KAAKhB,KAAf;AACAE,QAAAA,IAAI,CAACe,YAAL,CAAkB,MAAlB,EAA0B,QAA1B,EAHc,CAId;;AACAf,QAAAA,IAAI,CAACe,YAAL,CAAkB,YAAlB,EAAgC,eAAhC;AACAf,QAAAA,IAAI,CAACe,YAAL,CAAkB,SAAlB,EAA6B,mBAA7B;AACAf,QAAAA,IAAI,CAACe,YAAL,CAAkB,YAAlB,EAAgCC,IAAI,CAACC,SAAL,CAAe;AAC7Cb,UAAAA,SAAS,EAAE,KADkC;AAE7CC,UAAAA,SAAS,EAAE,KAFkC;AAG7CC,UAAAA,KAAK,EAAE,KAHsC;AAI7CC,UAAAA,WAAW,EAAE,KAJgC;AAK7CC,UAAAA,WAAW,EAAE,KALgC;AAM7CC,UAAAA,aAAa,EAAE,KAN8B;AAO7CC,UAAAA,SAAS,EAAE;AAPkC,SAAf,CAAhC;AASD;AACF;AAED;;;;;;;;;;;;;;;;;;;;;;yCAoBqB;AACnB,UAAI,KAAKZ,KAAT,EAAgB;AACd,aAAKA,KAAL,CAAWoB,MAAX,CAAkB,CAChBtB,eAAe,CAACuB,WAAhB,CAA4B,KAAKC,KAAL,CAAWC,IAAvC,CADgB,CAAlB;AAGD;AACF;;;;EA/EiB1B,S;AAkFpB;;;;;;;;;;;;;;AAaA,eAAeE,KAAf","sourcesContent":["import React, { Component } from 'react';\nimport { Table } from '@jpmorganchase/perspective';\nimport { ServerRespond } from './DataStreamer';\nimport { DataManipulator } from './DataManipulator';\nimport './Graph.css';\n\ninterface IProps {\n  data: ServerRespond[],\n}\n\ninterface PerspectiveViewerElement extends HTMLElement {\n  load: (table: Table) => void,\n}\nclass Graph extends Component<IProps, {}> {\n  table: Table | undefined;\n\n  render() {\n    return React.createElement('perspective-viewer');\n  }\n\n  componentDidMount() {\n    // Get element from the DOM.\n    const elem = document.getElementsByTagName('perspective-viewer')[0] as unknown as PerspectiveViewerElement;\n\n    const schema = {\n      price_abc: 'float',\n      price_def: 'float',\n      ratio: 'float',\n      lower_bound: 'float',\n      upper_bound: 'float',\n      trigger_alert: 'float',\n      timestamp: 'date',\n    };\n\n    /*\n    ● Since we don’t want to distinguish between two stocks now, but instead want to track their\n      ratios, we made sure to add the ratio field. Since we also wanted to track upper_bound,\n      lower_bound, and the moment when these bounds are crossed i.e. trigger_alert, we had to\n      add those fields too.\n    ● Finally, the reason we added price_abc and price_def is just because these were necessary\n       get the ratio as you will see later. We won’t be configuring the graph to show them anyway.\n    ● Of course since we’re tracking all of this with respect to time, timestamp is going to be there\n    */\n\n    if (window.perspective && window.perspective.worker()) {\n      this.table = window.perspective.worker().table(schema);\n    }\n    if (this.table) {\n      // Load the `table` in the `<perspective-viewer>` DOM reference.\n      elem.load(this.table);\n      elem.setAttribute('view', 'y_line');\n      // elem.setAttribute('column-pivots', '[\"stock\"]');\n      elem.setAttribute('row-pivots', '[\"timestamp\"]');\n      elem.setAttribute('columns', '[\"top_ask_price\"]');\n      elem.setAttribute('aggregates', JSON.stringify({\n        price_abc: 'avg',\n        price_def: 'avg',\n        ratio: 'avg',\n        lower_bound: 'avg',\n        upper_bound: 'avg',\n        trigger_alert: 'avg',\n        timestamp: 'distinct count',\n      }));\n    }\n  }\n\n  /* \n  ● ‘view’ is the the kind of graph we wanted to visualize the data as. Initially, this is\n    already set to y_line. This is the type of graph we want so we’re good here.\n  ● ‘column-pivots’ used to exist and was what allowed us to distinguish / split\n    stock ABC with DEF back in task 2. We removed this because we’re concerned\n    about the ratios between two stocks and not their separate prices\n  ● ‘row-pivots’ takes care of our x-axis. This allows us to map each datapoint\n    based on the timestamp it has. Without this, the x-axis is blank. So this field\n    and its value remains\n  ● ‘columns’ is what will allow us to only focus on a particular part of a datapoint’s\n    data along the y-axis. Without this, the graph will plot all the fields and values of\n    each datapoint and it will be a lot of noise. For this case, we want to track ratio,\n    lower_bound, upper_bound and trigger_alert.\n  ● ‘aggregates’ is what will allow us to handle the cases of duplicated data we\n    observed way back in task 2 and consolidate them as just one data point. In\n    our case we only want to consider a data point unique if it has a timestamp.\n    Otherwise, we will average out the all the values of the other non-unique fields\n    these ‘similar’ datapoints before treating them as one (e.g. ratio, price_abc, …)\n  */\n\n  componentDidUpdate() {\n    if (this.table) {\n      this.table.update([\n        DataManipulator.generateRow(this.props.data),\n      ]);\n    }\n  }\n}\n\n/* \n● To fully achieve our goal in this task, we have to make some modifications in\n  the DataManipulator.ts file. This file will be responsible for processing the raw\n  stock data we’ve received from the server before it throws it back to the Graph\n  component’s table to render. Initially, it’s not really doing any processing hence\n  we were able to keep the status quo from the finished product in task 2\n● The first thing we have to modify in this file is the Row interface. If you notice,\n  the initial setting of the Row interface is almost the same as the old schema in\n  Graph.tsx before we updated it. So now, we have to update it to match the\n  new schema. See next slide to better visualize the change that’s supposed to\n  happen. \n*/\n\nexport default Graph;\n"]},"metadata":{},"sourceType":"module"}